# 概要

- 基礎からわかるTCP/IP ネットワーク実験プログラミング（第2版）の 6 章を読んで、調査・検証したり、実装して得た知見をまとめていく。

- このプログラムを動作検証させるのは難しそうなので、Ethernet のヘッダや ARP のヘッダの作成の仕方を学びたいと考えている。プログラムのコンパイルが通れば最低限は大丈夫とみなす。

## arpupdate.c に関して

- このプログラムは、ARP 応答パケットの偽装, ARP 要求パケットの偽装, 偽装した ARP パケット の送信 をするプログラムである。

- 目的は、ホスト A が特定の IP アドレスの紐付いているホストを通信不能にすることである。
- ARP 応答パケットを偽造する。
  - A は D から ARP 要求パケットを受け取る。
  - A は D に ARP 応答パケットを送信する。このパケットに不適切な MAC アドレスを入れて送信すると、D の ARP テーブルがおかしくなる。
  - これは、C が D を騙す構図である。

- ARP 要求パケットを偽造する。
  - A は D から ARP 要求パケットを受け取る。
  - A は受け取った要求パケットをもとに D に ARP 要求パケットを送信する。このパケットに不適切な MAC アドレスを入れて送信すると、D の ARP テーブルがおかしくなる。
  - ARP 要求パケットを受け取ったホストは、自信の ARP テーブルを変更することを利用して D と C の間を通信不能にする。
  - これは、D が C を騙す構図である。

- 偽造した ARP 要求パケットを送信する。
  - A は D から ARP 要求パケットを受け取る。
  - A は受け取った要求パケットをもとにホスト D に偽造した ARP 要求パケットを送信する。原理は 2 と同じである。
  - そもそも、このパケット自体存在しない。
  - これは、C が D を騙す構図である。

## 実装方針

- MAC アドレスは `struct sockaddr` 型の変数に代入する。これは、sendto などの第五引数に該当する。
- `/usr/include/sys/socket.h`
- `/usr/include/bits/socket.h`

- socket() の第三引数には、`htons(ETH_P_ARP)` を入れて、Ethernet ヘッダを直接操作してパケットを送受信する。
- `/usr/include/netinet/if_ether.h`
